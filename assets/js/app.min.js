$(document).ready(function() {

    // Ripple-effect animation
    $(".ripple-effect").click(function(e){

        var rippler = $(this);

        if (!rippler.hasClass('animated')) {

            rippler.addClass('animated');

            if (rippler.find('.ink').length == 0) {
                rippler.append("<span class='ink'></span>");
            }

            var ink = rippler.find('.ink');

            if(!ink.height() && !ink.width()) {
                var d = Math.max(rippler.outerWidth(), rippler.outerHeight());
                ink.css({height: d, width: d});
            }

            var x = e.pageX - rippler.offset().left - ink.width() / 2;
            var y = e.pageY - rippler.offset().top - ink.height() / 2;

            ink.css({
              top: y + 'px',
              left: x + 'px'
            }).addClass('animate');

            setTimeout(function(){
                rippler.removeClass('animated')
                ink.remove();
            }, 500);
        }

    });
});
$(document).ready(function() {

  lang = $('body').data('lang');

  window.iecheck = function() {
    return window.navigator.userAgent.indexOf("MSIE ") > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./);
  }

  window.mobilecheck = function() {
      var check = false;
      (function(a,b){ if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
      return check;
  }

  if ( window.mobilecheck() ) $('body').addClass('mobile')
  if ( window.iecheck() ) $('body').addClass('ie')
  // if ( window.mobilecheck() && window.iecheck() ) window.location.replace('http://browsehappy.com/?locale=' + lang);

  // Global values
  win_width  = $(window).width();
  win_height = $(window).height();
  page_url = window.location.href;
  domain = page_url.split("/");

  $(window).on('load', function () {

    // Fitting blocks size to screen size
    $(".full-screen-block").height( win_height );
    $(".thumb-wrap, .work-wrap").height( win_height );

    // Clear form data
    $('input, textarea').val('');

    responsive_actions();

    // Set rangom poster
    setTimeout(function(){

        img_url = 'url(' + domain[0] + '//' + domain[2] + '/assets/img/posters/web.jpg)';
        $('.section-blog .preview-container .poster').css('background-image', img_url);
    }, 100)

  });


  $(window).on('resize', function () {

    // Fitting blocks size to screen size
    setTimeout(function() {
      $(".full-screen-block").height( win_height );
      $(".thumb-wrap, .work-wrap").height( win_height );
    }, 100)

    responsive_actions();

    win_width  = $(window).width();
    win_height = $(window).height();

  });


  // Loading particular ava depanding on viewport
  function responsive_actions() {
    if ( win_width > 1000) {
      $('#small-ava').attr('src', $('#small-ava').data('src'));
    } else {
      if (lang == 'ru') {
          $('.section-about .section-title').text('Константин Наумов')
      }
      $('#large-ava').attr('src', $('#large-ava').data('src'));
      $('.about-contact').attr('href', '#contact');
    }
  }


});











$(window).load(function() {
  setTimeout(function(){
    $('#status').fadeOut();
    $('#preloader').hide();
    $('#header').addClass('section-active');
  }, 100)
})

var createCookie = function(name, value, days) {
    var expires;
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toGMTString();
    }
    else {
        expires = "";
    }
    document.cookie = name + "=" + value + expires + "; path=/";
}

function getCookie(c_name) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) {
                c_end = document.cookie.length;
            }
            return unescape(document.cookie.substring(c_start, c_end));
        }
    }
    return "";
}
$(document).ready(function() {

  nav_index = 0;
  sections = [];
  section_containers = $('.full-screen-block');

  $('nav.main-nav .item').each(function(index, el) {
    sections.push($(el).attr('href'));
  });

  // nav click
  $('nav.main-nav > *').click(function(event) {

      if (!$(this).hasClass('active')) {

          move_pages($(this).index());

          // slide back portfolio and blog
          if (work_opened) slide_back();
          if (blog_opened) blog_slide_back();
      }

  });


  $(window).on("load", function() {

      nav_index = get_page_from_location();

      if (nav_index >= 0) {
          window.location.hash = sections[nav_index];
          show_section(nav_index);
          page_actions(nav_index);
      } else {
          nav_index = 0;
          show_section(nav_index);
          blog_belt.addClass('slided');
          var hash = window.location.hash.substring(1);
          blog_opened = true;
          var content = $('.post-content');
          content.load('/blog-posts/' + hash, function() {
              $('.post-title .title-text').text(content.find('.title').text());
              $('.post-title .date').text(content.find('.date').text());
              $('aside .blog-return').show();
              $('.post-poster').css('background-image', 'url(../../blog-posters/'+ content.find('.title').data('poster') +')');
          });
      }

      $('nav .item').eq(nav_index).addClass('first-loaded');

      setTimeout(function(){
          $('.first-loaded').removeClass('first-loaded').addClass('active');
      }, 200);
  });


  $(window).on('hashchange',function(){

      nav_index = get_page_from_location();

      if (nav_index >= 0) {
          higlight_link(nav_index);
          show_section(nav_index);
          page_actions(nav_index);
      }
  });


  function get_page_from_location() {

      hash = window.location.hash;
      if ( hash == '' ) return  0;
      if ( hash.length > 0 ) {
          var nav_index = sections.indexOf(hash);
          return  nav_index;
      }
  }

  function show_section(nav_index) {

      $(section_containers).hide();
      $(section_containers).eq(nav_index).show();
  }

  function move_pages(nav_index) {

      higlight_link(nav_index);
      page_actions(nav_index);
      show_section(nav_index)
  }

  function higlight_link(index) {
      $('nav .item').eq(index)
        .addClass('active')
        .siblings().removeClass('active');
  }

  function page_actions (nav_index) {

      if ( nav_index == 1 ) {
          skills_animate();
          $('.section-about .poster.me').css('background-image', 'url(/assets/img/posters/me.jpg)');
      }

      if ( nav_index == 2 && !$('.section-work').hasClass('viewed') ) {
          $('.section-work')
            .addClass('viewed')
            .find('img')
              .each(function(index, el) {
                $(el).attr('src', $(el).data('src')).removeAttr('data-src');
              });;
       }

       if ( nav_index == 3 && !$('.section-contact').hasClass('viewed') ) {
           var cantact = $('.section-contact');
           cantact.addClass('viewed');
           cantact.find('.poster').css('background-image', 'url(/assets/img/posters/contact.jpg)');
        }

      if ( nav_index == 4 && !$('.exp-animation').hasClass('viewed') ) {
          $('.exp-animation')
            .addClass('viewed')
            .find('.wrap').load( '../assets/exp/exp_html.html');
          $('.section-expirience .poster.exp').css('background-image', 'url(/assets/img/posters/skillset.jpg)');
      }
  }

});

jQuery(document).ready(function($) {

  var dropy = {
    $dropys: null,
    openClass: 'open',
    selectClass: 'selected',
    init: function(){
      var self = this;

      self.$dropys = $('.dropy');
      self.eventHandler();
    },
    eventHandler: function(){
      var self = this;

      // Opening a dropy
      self.$dropys.find('.dropy__title').on('click', function(event) {
        var that = $(this);
        self.$dropys.removeClass(self.openClass);
        that.parents('.dropy').addClass(self.openClass);
      });

      // Click on a dropy list
      self.$dropys.find('.dropy__content').on('click', 'li', function(event) {

        var cat_name = $(this).attr('data-cat');
        var position = 'top center';
        var img_url = 'url(' + domain[0] + '//' + domain[2] + '/assets/img/posters/' + cat_name + '.jpg)';

        if (cat_name == 'life') {
            position = 'top right';
        }

        $('.section-blog .poster').css({
          'background-image': img_url,
          'background-position': position
        });

        load_cat(cat_name);
        set_dropdown_value(cat_name);

      });

      self.$dropys.find('.dropy__content ul ').on('mouseleave', function(event) {
        $('#cat-sel .dropy').removeClass('open');
      });

      self.$dropys.find('.cross').on('click', function(event) {
        $('#cat-sel .dropy').removeClass('open');
      });

      // Close all dropdown onclick on another element
      $(document).bind('click', function(e){
          if (! $(e.target).parents().hasClass('dropy')){ self.$dropys.removeClass(self.openClass); }
      });
    }
  };

  $(function(){
    dropy.init();
  });

});

function set_dropdown_value(cat) {

    var $list  = $('#cat-sel ul')
        $that  = $list.find('li[data-cat='+cat+']'),
        $input = $('#cat-sel input'),
        $dropy = $('#cat-sel .dropy'),
        $title = $('#cat-sel .dropy__title span.tit');
        $post_wrap = $('#blog-posts');

    $title.html($that.text()).addClass('selected');
    $input.val($that.attr('data-value')).trigger('change');
    $dropy.removeClass('open');
    $post_wrap.attr('data-cat', cat);
    $that.remove();
    $list .prepend('<li data-cat=' + cat + '>' + $that.text() + '</li>');
}


$(document).ready(function() {

  $('.lang-switcher span').click(function(event) {

      $.removeCookie('lang',  { path: '/' });

      var dist_lang = $(this).data('lang');

      $.cookie('lang', dist_lang,  { expires: 360, path: '/' });

      if ( sections.indexOf(window.location.hash) == -1 ) window.location.hash = '';


      if ( dist_lang == 'ru' ) {
          window.location.replace(window.location.origin + '/ru' + window.location.hash);
      } else if ( dist_lang == 'en' ) {
          window.location.replace(window.location.origin + '/en' + window.location.hash);
      }

  });

});

(function (factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD
    define(['jquery'], factory);
  } else if (typeof exports === 'object') {
    // CommonJS
    factory(require('jquery'));
  } else {
    // Browser globals
    factory(jQuery);
  }
}(function ($) {

  var pluses = /\+/g;

  function encode(s) {
    return config.raw ? s : encodeURIComponent(s);
  }

  function decode(s) {
    return config.raw ? s : decodeURIComponent(s);
  }

  function stringifyCookieValue(value) {
    return encode(config.json ? JSON.stringify(value) : String(value));
  }

  function parseCookieValue(s) {
    if (s.indexOf('"') === 0) {
      // This is a quoted cookie as according to RFC2068, unescape...
      s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
    }

    try {
      // Replace server-side written pluses with spaces.
      // If we can't decode the cookie, ignore it, it's unusable.
      // If we can't parse the cookie, ignore it, it's unusable.
      s = decodeURIComponent(s.replace(pluses, ' '));
      return config.json ? JSON.parse(s) : s;
    } catch(e) {}
  }

  function read(s, converter) {
    var value = config.raw ? s : parseCookieValue(s);
    return $.isFunction(converter) ? converter(value) : value;
  }

  var config = $.cookie = function (key, value, options) {

    // Write

    if (arguments.length > 1 && !$.isFunction(value)) {
      options = $.extend({}, config.defaults, options);

      if (typeof options.expires === 'number') {
        var days = options.expires, t = options.expires = new Date();
        t.setTime(+t + days * 864e+5);
      }

      return (document.cookie = [
        encode(key), '=', stringifyCookieValue(value),
        options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
        options.path    ? '; path=' + options.path : '',
        options.domain  ? '; domain=' + options.domain : '',
        options.secure  ? '; secure' : ''
      ].join(''));
    }

    // Read

    var result = key ? undefined : {};

    // To prevent the for loop in the first place assign an empty array
    // in case there are no cookies at all. Also prevents odd result when
    // calling $.cookie().
    var cookies = document.cookie ? document.cookie.split('; ') : [];

    for (var i = 0, l = cookies.length; i < l; i++) {
      var parts = cookies[i].split('=');
      var name = decode(parts.shift());
      var cookie = parts.join('=');

      if (key && key === name) {
        // If second argument (value) is a function it's a converter...
        result = read(cookie, value);
        break;
      }

      // Prevent storing a cookie that we couldn't decode.
      if (!key && (cookie = read(cookie)) !== undefined) {
        result[name] = cookie;
      }
    }

    return result;
  };

  config.defaults = {};

  $.removeCookie = function (key, options) {
    if ($.cookie(key) === undefined) {
      return false;
    }

    // Must not alter options, thus extending a fresh object...
    $.cookie(key, '', $.extend({}, options, { expires: -1 }));
    return !$.cookie(key);
  };

}));

$(document).ready(function() {

  $.ajaxSetup({ cache: true });

  var exp_nav_wrap = $('.exp-nav'),
      exp_nav_select = $('.exp-nav .select-skill'),
      exp_nav_li = $('nav.select-skill li'),
      exp_nav_selected = $('nav.select-skill .selected-center span'),
      tmp_text = exp_nav_selected.text(),
      active_class = 'active-exp-tab',
      exp_tabs = $('.exp-tab'),
      exp_texts_wrap = $('.exp-unit-wrapper'),
      animation_wrap = $('.exp-animation .wrap')

  $('.exp-unit').eq(0).addClass('active-exp-tab');

  exp_nav_wrap
    .click(function() {
        if (!exp_nav_select.hasClass('animating')) {
            $(this).find('.select-skill').addClass('opened show-list');
            exp_texts_wrap.addClass('faded-out');
            new_text = exp_nav_selected.text();
            exp_nav_selected.text(tmp_text)
        };
    });


  $('.select-option').click(function(event) {

    $(this).addClass('checked');

    if (exp_nav_select.hasClass('opened')) {

      var that = $(this);

      animation_wrap.load('../assets/' + that.data('file'));

      setTimeout(function(){

        setTimeout(function(){
            exp_nav_selected.text(that.text());
            setTimeout(function(){
            exp_texts_wrap.removeClass('faded-out');
            exp_nav_select.removeClass('animating')
            }, 50);
        }, 500);

        setTimeout(function(){
            exp_nav_select.removeClass('show-list');
        }, 450);

        exp_nav_select.removeClass('opened').addClass('animating');

      }, 500);

      $('.exp-unit')
        .removeClass(active_class)
        .eq($(this).data('index') - 1).addClass(active_class);
      } else {
        exp_nav_select.addClass('opened show-list');
        exp_texts_wrap.addClass('faded-out');
      }
  });



});




$(document).ready(function() {

  $(window).on('load', function () {
    $('input, textarea').each(function(index, el) {
      if ( $(el).val() != '' ) $(el).addClass('has-value');
    });
  });

  var form         =  $('.awesome-form');
  var form_msg     =  $('.awesome-form textarea');
  var form_name    =  $('.awesome-form input[name=name]');
  var form_email   =  $('.awesome-form input[name=email]');
  var form_submit  =  $('.awesome-form button');

  function getDataFromField(element) {
    return $(element).val();
  }

  $(form).submit(function(event) {
    event.preventDefault();
    $.ajax({
        url: "//formspree.io/const.int.naumov@gmail.com",
        method: "POST",
        data: {
          name: getDataFromField(form_name),
          email: getDataFromField(form_email),
          message: getDataFromField(form_msg),
        },
        dataType: "json"
    });

    $(form_name).val('').removeClass('has-value');
    $(form_email).val('').removeClass('has-value');
    $(form_msg).val('').removeClass('has-value');
    $(form_submit).text('Thank you! I promise to reply asap ☺')
  });


  // Manage Intut Titles
  $('.awesome-form input, .awesome-form .textarea').focusout(function(){

      if($(this).val() === "") {
        $(this).removeClass('has-value');
      } else {
        $(this).addClass('has-value');
      }

  });


  // Auto resize textarea
  var content, hiddenDiv, txt;

  txt = $('.awesome-form textarea');
  hiddenDiv = $('#auto-height-hidden-div');
  content = null;

  txt.on('keyup focus', function() {
    content = $(this).val();
    content = content.replace(/\n/g, '<br>');
    hiddenDiv.html(content + '<br><br>');
    $('.textarea-wrapper').css('height', hiddenDiv.height());
    $(this).css('height', hiddenDiv.height() - 2);
  });

  txt.on('focusout', function() {
    content = $(this).val();
    content = content.replace(/\n/g, '<br>');
    hiddenDiv.html(content);
    ta_size = (hiddenDiv.height() < 28 ) ? 28 : hiddenDiv.height();
    wra_size = (hiddenDiv.height() < 60 ) ? 60 : hiddenDiv.height();
    $('.textarea-wrapper').css('height', wra_size);
    $(this).css('height', ta_size);
  });

});
$(document).ready(function() {

  // Var init
  work_section = $('.section-work');
  navigation = $('nav');
  show_work_trigger = $('.thumb-click-area');
  loader_work = $('.loader.work');
  work_belt = $('.work-belt');
  work_wrap = $('.work-wrap');
  work_container = $('.work-container');
  return_sign = $('.work-return');
  thumb_wrap_shift = $('.thumb-wrap-shift')
  animating_work = false;
  work_opened = false;


  $.ajaxSetup({ cache: true });

  // Click handlers
  show_work_trigger.click(function() {

      if (animating_work) return;

      var that = $(this),
          newTitle = that.data('name'),
          newUrl = that.data('url'),
          folderIndex = that.data('folder');

      animating_work = work_opened = true;

      work_belt.addClass("slided");

      setTimeout(function(){
        $('aside .work-return').show();
        animating_work = false;
      }, 800);

      // Add content
      $('.project-load')
        .addClass('loaded')
        .find('img')
          .attr('src', '../assets/img/work/proj-' + folderIndex + '/image.jpg');

      $('.project-title span.title-text').text(newTitle);

      if (newUrl != '') {
        $('.project-url').attr('href', 'http://' + newUrl);
      }

  });

  return_sign.click(function() {
    slide_back();
  });


});

function slide_back () {

  if ( !animating_work && work_opened ) {
      animating_work = true;
      work_opened = false;

    $('.project-load').removeClass('loaded');
    work_belt.removeClass('slided');
    $('aside .work-return').hide();
    setTimeout(function(){
      animating_work = false;
      $('.project-load img').attr('src', '');
    }, 800);
  }
}


// Skills animate functions
function skills_animate() {

  setTimeout(function(){

    $(".meter > span").each(function() {
      var element = $(this);
      var container_width = $('.skill-unit:first-child .meter').width();
      var skill_value = $(this).data("skill");
      var indexOfBar = $(this).parents('.skill-unit').index();

      setTimeout(function () {
        animateBars(element);
      }, 300 * indexOfBar);

      function animateBars(element) {
        $(element).css({
          width: skill_value * 10 + '%',
          opacity: 0.1 * skill_value
        });
      }
    })


  }, 1000)

}



var
    blog_previews_container = $('#blog .preview-container-shift'),
    blog_previews = $('#blog-posts'),
    blog_belt = $('.blog-belt'),
    post_section = $('.post-section');

    blog_return = $('.blog-return'),
    post_poster = $('.post-poster'),
    post_content = $('.post-content');

    total_number = blog_previews.data('total-number'),
    pager_size = blog_previews.data('pager-number'),
    shown_pages = 1,
    loading_offset = 200; // Loading starts px from bottom
    animating_blog = blog_opened = false,
    page_folders_number = Math.ceil(total_number / pager_size);


$(document).ready(function() {

    // Show category posts
    $(blog_previews_container).on('click', '.hashtag', function(event) {

        load_tag($(this).text());
    });


    // Infinite scroll
    $(blog_previews_container).on('scroll', function(event) {
        if (!$(blog_previews_container).hasClass('prevent-scroll-load')) {
            load_if_nesessary();
        }
    });


    $(window).on('load', function () {
        shown_posts = $('.post-section .post-preview');
        var shown_posts_size = $(shown_posts).size();
        if ( shown_posts_size < 5 ) {
            load_new_posts(5 - shown_posts);
        }

        load_if_nesessary();
    })

    // If not enough posts
    function load_if_nesessary() {
        var top_offset  = $(blog_previews_container).scrollTop(),
            blog_height = $(blog_previews).outerHeight();

        if ( top_offset + loading_offset + win_height > blog_height) {
            load_new_posts(5, $(blog_previews).data('cat'))
        }
    }


    // Sliding 2 post
    $('#blog-posts').on('click', '.post-link, .post-name span', function(event) {

        if (animating_work) return;

        var that = $(this).parents('.post-preview'),
            newTitle = that.data('name'),
            newUrl = that.data('url'),
            newPoster = that.data('poster'),
            newDate = that.data('date'),
            newHash = newUrl.split('/');

        animating_blog = blog_opened = true;

        window.location.hash = newHash[newHash.length - 1];

        setTimeout(function(){
          $('aside .blog-return').show();
          animating_blog = false;
        }, 800);

        blog_belt.addClass('slided');


        // Put title
        $('.post-title .title-text').text(newTitle);
        $('.post-title .date').text(newDate.toLowerCase());

        // Load content
        $('.post-content').load(newUrl, function(){

            post_poster.css('background-image', 'url(../../blog-posters/'+ newPoster +')');
        });
    });


    blog_return.click(function() {
        window.location.hash = '#blog';
        blog_slide_back();
    });

});



// Add n posts
function load_new_posts(num, category, tag_name) {

    if (!category) return;

    if ( shown_pages < page_folders_number ) {

        shown_pages++;

        var cat = '.cat-' + category;
        if (category == 'all')  cat = '';

        var tag = '';
        if (tag_name) tag = '.tag-' + tag_name;

        $('#ccc').load( window.location.origin + '/pagination/page' + shown_pages +' .lang-' + lang + cat + tag, function(){

            $('.post-section').append($('#ccc').html());
            var loaded_size = $('#ccc .post-preview').size();

            $('#ccc').empty();

            if ( loaded_size < num ) {
                var rest = num - loaded_size;
                load_new_posts(rest, category, tag_name);
            }
        });
    } else {
        blog_previews_container.addClass('prevent-scroll-load')
    }

}


function load_cat(cat) {

    if (!cat) return

    blog_previews_container.addClass('prevent-scroll-load');

    shown_pages = 1;
    $('.post-section').empty();
    $(shown_posts).each(function(index, el) {
       if ( $(el).hasClass('cat-' + cat) ) {
          $('.post-section').append($(el));
       }
    });
    $('.dropy__title .hsh').text('');
    load_new_posts(total_number, cat);
}


function load_tag(tag) {

    if (!tag) return

    blog_previews_container.addClass('prevent-scroll-load');

    shown_pages = 1;
    $('.post-section').empty();
    $(shown_posts).each(function(index, el) {
       if ( $(el).hasClass('tag-' + tag) ) {
          $('.post-section').append($(el));
       }
    });

    $('.dropy__title .hsh').text('#' + tag);
    load_new_posts(total_number, 'all', tag);
}


function blog_slide_back () {

  if ( !animating_blog && blog_opened ) {

        animating_blog = true;
        blog_opened = false;

        $('.blog-belt').removeClass('slided');
        $('aside .blog-return').hide();

        setTimeout(function(){
            animating_blog = false;
            post_poster.css('background-image', 'none');
            $('.post-content').empty();
        }, 800);
  }
}
